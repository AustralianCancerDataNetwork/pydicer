<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Working with Data" href="WorkingWithData.html" /><link rel="prev" title="Auto-segmentation Inference &amp; Analysis" href="AutoSegmentation.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>nnUNet Data Preparation - PyDicer documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">PyDicer  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">PyDicer  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="GettingStarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="ConvertingData.html">Converting Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="VisualiseData.html">Visualise Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Radiomics.html">Compute Radiomics</a></li>
<li class="toctree-l1"><a class="reference internal" href="DoseMetrics.html">Dose Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="DatasetPreparation.html">Dataset Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="AutoSegmentation.html">Auto-segmentation Inference &amp; Analysis</a></li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">nnUNet Data Preparation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="WorkingWithData.html">Working with Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="WorkingWithStructures.html">Working with Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="ObjectGeneration.html">Generating Data Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="Configuration.html">Configuration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../code_of_conduct.html">Code of Conduct</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tool.html">PyDicer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input.html">Input</a></li>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils.html">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preprocess.html">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../convert.html">Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../visualise.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataset.html">Dataset Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../analyse.html">Analyse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../generate.html">Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nnunet.html">nnUNet</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="nnUNet-Data-Preparation">
<h1>nnUNet Data Preparation<a class="headerlink" href="#nnUNet-Data-Preparation" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/AustralianCancerDataNetwork/pydicer/blob/main/examples/nnUNet.ipynb"><img alt="Open In Colab" src="https://colab.research.google.com/assets/colab-badge.svg" /></a></p>
<p>The <a class="reference external" href="https://github.com/MIC-DKFZ/nnUNet">nnUNet</a> is a self-configuring method for deep learning-based biomedical image segmentation. However it does require data to be formatted in a specific way on the file system. In this notebook, we demonstrate some useful functionality to prepare a dataset converted by PyDicer for training using nnUNet.</p>
<blockquote>
<div><p>Note: PyDicer currently only supports nnUNet v1. Contributions adding support for nnUNet v2 are welcome.</p>
</div></blockquote>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pydicer</span> <span class="kn">import</span> <span class="n">PyDicer</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pydicer
    <span class="kn">from</span> <span class="nn">pydicer</span> <span class="kn">import</span> <span class="n">PyDicer</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">from</span> <span class="nn">pydicer.utils</span> <span class="kn">import</span> <span class="n">fetch_converted_test_data</span>

<span class="kn">from</span> <span class="nn">pydicer.dataset.nnunet</span> <span class="kn">import</span> <span class="n">NNUNetDataset</span>
<span class="kn">from</span> <span class="nn">pydicer.dataset.structureset</span> <span class="kn">import</span> <span class="n">StructureSet</span>
<br/></pre></div>
</div>
</div>
<section id="Setup-nnUNet">
<h2>Setup nnUNet<a class="headerlink" href="#Setup-nnUNet" title="Permalink to this heading">#</a></h2>
<p>Consult the <a class="reference external" href="https://github.com/MIC-DKFZ/nnUNet/tree/master/documentation">nnUNet documentation</a> for details on how to install nnUNet, setup folder paths and conduct model training. The dataset will be prepared in the <code class="docutils literal notranslate"><span class="pre">nnUNet_raw_data_base</span></code> directory. If you already have this set in your environment you can remove the following cell. For demonstration purposes, we set our <code class="docutils literal notranslate"><span class="pre">nnUNet_raw_data_base</span></code> to a scratch directory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;nnUNet_raw_data_base&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./nnScratch&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="Setup-PyDicer">
<h2>Setup PyDicer<a class="headerlink" href="#Setup-PyDicer" title="Permalink to this heading">#</a></h2>
<p>For this example, we will use the LCTSC test data which has already been converted using PyDicer. We also initialise our PyDicer object.</p>
<p>For working with nnUNet, we set the PyDicer logging verbosity to <code class="docutils literal notranslate"><span class="pre">INFO</span></code>, so that we can see the relevant output being generated by the tool.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">working_directory</span> <span class="o">=</span> <span class="n">fetch_converted_test_data</span><span class="p">(</span><span class="s2">&quot;./testdata_lctsc&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">=</span><span class="s2">&quot;LCTSC&quot;</span><span class="p">)</span>
<span class="n">pydicer</span> <span class="o">=</span> <span class="n">PyDicer</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="n">pydicer</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Working directory %s aready exists, won&#39;t download test data.
</pre></div></div>
</div>
</section>
<section id="Define-Structures">
<h2>Define Structures<a class="headerlink" href="#Define-Structures" title="Permalink to this heading">#</a></h2>
<p>PyDicer uses the <a class="reference external" href="https://australiancancerdatanetwork.github.io/pydicer/_examples/WorkingWithStructures.html">structure name mapping</a> functionality to determine which structures to train the nnUNet model for. Here we add a structure name mapping for this task.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mapping_id</span> <span class="o">=</span> <span class="s2">&quot;nnunet_lctsc&quot;</span>
<span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Esophagus&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;Heart&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;Lung_L&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;L_Lung&quot;</span><span class="p">,</span> <span class="s2">&quot;Lung_Left&quot;</span><span class="p">],</span>
    <span class="s2">&quot;Lung_R&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;Lung_Right&quot;</span><span class="p">],</span>
    <span class="s2">&quot;SpinalCord&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;SC&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">pydicer</span><span class="o">.</span><span class="n">add_structure_name_mapping</span><span class="p">(</span>
    <span class="n">mapping_id</span><span class="o">=</span><span class="n">mapping_id</span><span class="p">,</span>
    <span class="n">mapping_dict</span><span class="o">=</span><span class="n">mapping</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pydicer.utils - INFO - Adding mapping for project in testdata_lctsc/.pydicer
</pre></div></div>
</div>
</section>
<section id="Initialise-NNUNetDataset-object">
<h2>Initialise <code class="docutils literal notranslate"><span class="pre">NNUNetDataset</span></code> object<a class="headerlink" href="#Initialise-NNUNetDataset-object" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">NNUNetDataset</span></code> class provides the functionality to prepare a dataset from PyDicer data. Here we create an object of this class for use in this example. Check out the <a class="reference external" href="https://australiancancerdatanetwork.github.io/pydicer/nnunet.html">documentation</a> for more information on how the <code class="docutils literal notranslate"><span class="pre">NNUNetDataset</span></code> class works.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nnunet_task_id</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">nnunet_task_name</span> <span class="o">=</span> <span class="s2">&quot;LCTSC_Test&quot;</span>
<span class="n">nnunet_task_description</span> <span class="o">=</span> <span class="s2">&quot;A dummy nnUNet task for demonstration purposes&quot;</span>

<span class="n">nnunet</span> <span class="o">=</span> <span class="n">NNUNetDataset</span><span class="p">(</span>
    <span class="n">working_directory</span><span class="p">,</span>
    <span class="n">nnunet_task_id</span><span class="p">,</span>
    <span class="n">nnunet_task_name</span><span class="p">,</span>
    <span class="n">nnunet_task_description</span><span class="p">,</span>
    <span class="n">mapping_id</span><span class="o">=</span><span class="n">mapping_id</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Inspect-Dataset">
<h2>Inspect Dataset<a class="headerlink" href="#Inspect-Dataset" title="Permalink to this heading">#</a></h2>
<p>Our <code class="docutils literal notranslate"><span class="pre">NNUNetDataset</span></code> tool expects to have exactly one image and one structure set per patient (multi-modal training not yet supported, contributions welcome). Let’s fetch our converted DataFrame to confirm that this is the case.</p>
<p>If your dataset isn’t yet in such as state, you can use the <a class="reference external" href="https://australiancancerdatanetwork.github.io/pydicer/_examples/DatasetPreparation.html">dataset preparation</a> module in PyDicer to prepare a subset of data. Once the dataset is prepared, pass the <code class="docutils literal notranslate"><span class="pre">dataset_name</span></code> argument when creating the <code class="docutils literal notranslate"><span class="pre">NNUNetDataset</span></code> object above.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pydicer</span><span class="o">.</span><span class="n">read_converted_data</span><span class="p">(</span><span class="n">working_directory</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sop_instance_uid</th>
      <th>hashed_uid</th>
      <th>modality</th>
      <th>patient_id</th>
      <th>series_uid</th>
      <th>for_uid</th>
      <th>referenced_sop_instance_uid</th>
      <th>path</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.168227681755...</td>
      <td>5adf40</td>
      <td>CT</td>
      <td>LCTSC-Train-S1-007</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.335375068555...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.187709044743...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-007/images/...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.284338872489...</td>
      <td>ed6686</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Train-S1-007</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.284338872489...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.187709044743...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.168227681755...</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-007/structu...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.263565217029...</td>
      <td>88c5ef</td>
      <td>CT</td>
      <td>LCTSC-Train-S1-006</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.770569242984...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.325217978839...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-006/images/...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.161109536301...</td>
      <td>ceb111</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Train-S1-006</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.161109536301...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.325217978839...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.263565217029...</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-006/structu...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.235489581364...</td>
      <td>914d57</td>
      <td>CT</td>
      <td>LCTSC-Test-S1-102</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.639871532605...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.408067568497...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Test-S1-102/images/9...</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.110977663386...</td>
      <td>6c6ea4</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Test-S1-102</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.110977663386...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.408067568497...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.235489581364...</td>
      <td>testdata_lctsc/data/LCTSC-Test-S1-102/structur...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.318848546630...</td>
      <td>aa38e6</td>
      <td>CT</td>
      <td>LCTSC-Train-S1-002</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.234842392725...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.145984743865...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-002/images/...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.291449913947...</td>
      <td>f036b8</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Train-S1-002</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.291449913947...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.145984743865...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.318848546630...</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-002/structu...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.217118546740...</td>
      <td>dd0026</td>
      <td>CT</td>
      <td>LCTSC-Train-S1-008</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.135073567254...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.243364093992...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-008/images/...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.225487254421...</td>
      <td>48a970</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Train-S1-008</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.225487254421...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.243364093992...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.217118546740...</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-008/structu...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.141349678572...</td>
      <td>d91c84</td>
      <td>CT</td>
      <td>LCTSC-Train-S1-004</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.269433294341...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.313160975008...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-004/images/...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.595315284787...</td>
      <td>61758b</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Train-S1-004</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.595315284787...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.313160975008...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.141349678572...</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-004/structu...</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.140943693489...</td>
      <td>738c1a</td>
      <td>CT</td>
      <td>LCTSC-Train-S1-005</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.338518041666...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.964812114328...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-005/images/...</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.214803404117...</td>
      <td>68d663</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Train-S1-005</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.214803404117...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.964812114328...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.140943693489...</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-005/structu...</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.188371727865...</td>
      <td>6834c9</td>
      <td>CT</td>
      <td>LCTSC-Train-S1-001</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.330486033168...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.109432485688...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-001/images/...</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.267594131248...</td>
      <td>b5bddb</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Train-S1-001</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.267594131248...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.109432485688...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.188371727865...</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-001/structu...</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.333558838494...</td>
      <td>666be6</td>
      <td>CT</td>
      <td>LCTSC-Test-S1-101</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.106943890850...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.171234424242...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Test-S1-101/images/6...</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.929007819506...</td>
      <td>cc682f</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Test-S1-101</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.280355341349...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.171234424242...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.333558838494...</td>
      <td>testdata_lctsc/data/LCTSC-Test-S1-101/structur...</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.159497309342...</td>
      <td>2bf2f9</td>
      <td>CT</td>
      <td>LCTSC-Train-S1-003</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.742383887179...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.803594135292...</td>
      <td>NaN</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-003/images/...</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.127494043495...</td>
      <td>8e34f9</td>
      <td>RTSTRUCT</td>
      <td>LCTSC-Train-S1-003</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.127494043495...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.803594135292...</td>
      <td>1.3.6.1.4.1.14519.5.2.1.7014.4598.159497309342...</td>
      <td>testdata_lctsc/data/LCTSC-Train-S1-003/structu...</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Check-Dataset">
<h2>Check Dataset<a class="headerlink" href="#Check-Dataset" title="Permalink to this heading">#</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">check_dataset</span></code> function confirms that we have one image and one structure set per patient in our dataset.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nnunet</span><span class="o">.</span><span class="n">check_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pydicer.dataset.nnunet - INFO - Dataset OK
</pre></div></div>
</div>
</section>
<section id="Split-Dataset">
<h2>Split Dataset<a class="headerlink" href="#Split-Dataset" title="Permalink to this heading">#</a></h2>
<p>Here we randomly split our dataset into a training and testing set. You can specify the <code class="docutils literal notranslate"><span class="pre">training_cases</span></code> and <code class="docutils literal notranslate"><span class="pre">testing_cases</span></code> to use in the <code class="docutils literal notranslate"><span class="pre">split_dataset</span></code> function. If these aren’t supplied, the <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html">train_test_split</a> function from <code class="docutils literal notranslate"><span class="pre">sklearn</span></code> will be used. You can pass keyword arguments to this function via the <code class="docutils literal notranslate"><span class="pre">split_dataset</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nnunet</span><span class="o">.</span><span class="n">split_dataset</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pydicer.dataset.nnunet - INFO - Dataset split OK
pydicer.dataset.nnunet - INFO - Training cases: [&#39;LCTSC-Train-S1-007&#39;, &#39;LCTSC-Train-S1-001&#39;, &#39;LCTSC-Test-S1-102&#39;, &#39;LCTSC-Train-S1-003&#39;, &#39;LCTSC-Train-S1-008&#39;, &#39;LCTSC-Train-S1-002&#39;, &#39;LCTSC-Train-S1-005&#39;]
pydicer.dataset.nnunet - INFO - Testing cases: [&#39;LCTSC-Test-S1-101&#39;, &#39;LCTSC-Train-S1-006&#39;, &#39;LCTSC-Train-S1-004&#39;]
</pre></div></div>
</div>
</section>
<section id="Check-for-Duplicate-Data">
<h2>Check for Duplicate Data<a class="headerlink" href="#Check-for-Duplicate-Data" title="Permalink to this heading">#</a></h2>
<p>Now that the dataset is split, we must ensure that none of the <code class="docutils literal notranslate"><span class="pre">training_cases</span></code> are present in the <code class="docutils literal notranslate"><span class="pre">testing_cases</span></code>. Even if the cases have different IDs, it is possible that through anonymisation the same patient is anonymised to two different IDs. The <code class="docutils literal notranslate"><span class="pre">check_duplicates_train_test</span></code> function will check the imaging data to ensure there are no duplicates.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nnunet</span><span class="o">.</span><span class="n">check_duplicates_train_test</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
pydicer.dataset.nnunet - INFO - No duplicate images found in training and testing sets
</pre></div></div>
</div>
</section>
<section id="Check-Structure-Names">
<h2>Check Structure Names<a class="headerlink" href="#Check-Structure-Names" title="Permalink to this heading">#</a></h2>
<p>The nnUNet requires that all structures are present for all cases (missing structures are not supported). The <code class="docutils literal notranslate"><span class="pre">check_structure_names</span></code> function will output a grid indicating where structures might be missing (or a structure name mapping is missing).</p>
<p>If there are any cases for which any of the structures are missing, this should be resolved (by adding a structure mapping or remove the case from the dataset) before proceeding.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_results</span> <span class="o">=</span> <span class="n">nnunet</span><span class="o">.</span><span class="n">check_structure_names</span><span class="p">()</span>
<span class="n">df_results</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<style type="text/css">
#T_54907_row0_col2, #T_54907_row0_col3, #T_54907_row0_col4, #T_54907_row0_col5, #T_54907_row0_col6, #T_54907_row1_col2, #T_54907_row1_col3, #T_54907_row1_col4, #T_54907_row1_col5, #T_54907_row1_col6, #T_54907_row2_col2, #T_54907_row2_col3, #T_54907_row2_col4, #T_54907_row2_col5, #T_54907_row2_col6, #T_54907_row3_col2, #T_54907_row3_col3, #T_54907_row3_col4, #T_54907_row3_col5, #T_54907_row3_col6, #T_54907_row4_col2, #T_54907_row4_col3, #T_54907_row4_col4, #T_54907_row4_col5, #T_54907_row4_col6, #T_54907_row5_col2, #T_54907_row5_col3, #T_54907_row5_col4, #T_54907_row5_col5, #T_54907_row5_col6, #T_54907_row6_col2, #T_54907_row6_col3, #T_54907_row6_col4, #T_54907_row6_col5, #T_54907_row6_col6, #T_54907_row7_col2, #T_54907_row7_col3, #T_54907_row7_col4, #T_54907_row7_col5, #T_54907_row7_col6, #T_54907_row8_col2, #T_54907_row8_col3, #T_54907_row8_col4, #T_54907_row8_col5, #T_54907_row8_col6, #T_54907_row9_col2, #T_54907_row9_col3, #T_54907_row9_col4, #T_54907_row9_col5, #T_54907_row9_col6 {
  background-color: green;
}
</style>
<table id="T_54907">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_54907_level0_col0" class="col_heading level0 col0" >patient_id</th>
      <th id="T_54907_level0_col1" class="col_heading level0 col1" >struct_hash</th>
      <th id="T_54907_level0_col2" class="col_heading level0 col2" >Esophagus</th>
      <th id="T_54907_level0_col3" class="col_heading level0 col3" >Heart</th>
      <th id="T_54907_level0_col4" class="col_heading level0 col4" >Lung_L</th>
      <th id="T_54907_level0_col5" class="col_heading level0 col5" >Lung_R</th>
      <th id="T_54907_level0_col6" class="col_heading level0 col6" >SpinalCord</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_54907_level0_row0" class="row_heading level0 row0" >0</th>
      <td id="T_54907_row0_col0" class="data row0 col0" >LCTSC-Train-S1-007</td>
      <td id="T_54907_row0_col1" class="data row0 col1" >ed6686</td>
      <td id="T_54907_row0_col2" class="data row0 col2" >1</td>
      <td id="T_54907_row0_col3" class="data row0 col3" >1</td>
      <td id="T_54907_row0_col4" class="data row0 col4" >1</td>
      <td id="T_54907_row0_col5" class="data row0 col5" >1</td>
      <td id="T_54907_row0_col6" class="data row0 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row1" class="row_heading level0 row1" >1</th>
      <td id="T_54907_row1_col0" class="data row1 col0" >LCTSC-Train-S1-006</td>
      <td id="T_54907_row1_col1" class="data row1 col1" >ceb111</td>
      <td id="T_54907_row1_col2" class="data row1 col2" >1</td>
      <td id="T_54907_row1_col3" class="data row1 col3" >1</td>
      <td id="T_54907_row1_col4" class="data row1 col4" >1</td>
      <td id="T_54907_row1_col5" class="data row1 col5" >1</td>
      <td id="T_54907_row1_col6" class="data row1 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row2" class="row_heading level0 row2" >2</th>
      <td id="T_54907_row2_col0" class="data row2 col0" >LCTSC-Test-S1-102</td>
      <td id="T_54907_row2_col1" class="data row2 col1" >6c6ea4</td>
      <td id="T_54907_row2_col2" class="data row2 col2" >1</td>
      <td id="T_54907_row2_col3" class="data row2 col3" >1</td>
      <td id="T_54907_row2_col4" class="data row2 col4" >1</td>
      <td id="T_54907_row2_col5" class="data row2 col5" >1</td>
      <td id="T_54907_row2_col6" class="data row2 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row3" class="row_heading level0 row3" >3</th>
      <td id="T_54907_row3_col0" class="data row3 col0" >LCTSC-Train-S1-002</td>
      <td id="T_54907_row3_col1" class="data row3 col1" >f036b8</td>
      <td id="T_54907_row3_col2" class="data row3 col2" >1</td>
      <td id="T_54907_row3_col3" class="data row3 col3" >1</td>
      <td id="T_54907_row3_col4" class="data row3 col4" >1</td>
      <td id="T_54907_row3_col5" class="data row3 col5" >1</td>
      <td id="T_54907_row3_col6" class="data row3 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row4" class="row_heading level0 row4" >4</th>
      <td id="T_54907_row4_col0" class="data row4 col0" >LCTSC-Train-S1-008</td>
      <td id="T_54907_row4_col1" class="data row4 col1" >48a970</td>
      <td id="T_54907_row4_col2" class="data row4 col2" >1</td>
      <td id="T_54907_row4_col3" class="data row4 col3" >1</td>
      <td id="T_54907_row4_col4" class="data row4 col4" >1</td>
      <td id="T_54907_row4_col5" class="data row4 col5" >1</td>
      <td id="T_54907_row4_col6" class="data row4 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row5" class="row_heading level0 row5" >5</th>
      <td id="T_54907_row5_col0" class="data row5 col0" >LCTSC-Train-S1-004</td>
      <td id="T_54907_row5_col1" class="data row5 col1" >61758b</td>
      <td id="T_54907_row5_col2" class="data row5 col2" >1</td>
      <td id="T_54907_row5_col3" class="data row5 col3" >1</td>
      <td id="T_54907_row5_col4" class="data row5 col4" >1</td>
      <td id="T_54907_row5_col5" class="data row5 col5" >1</td>
      <td id="T_54907_row5_col6" class="data row5 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row6" class="row_heading level0 row6" >6</th>
      <td id="T_54907_row6_col0" class="data row6 col0" >LCTSC-Train-S1-005</td>
      <td id="T_54907_row6_col1" class="data row6 col1" >68d663</td>
      <td id="T_54907_row6_col2" class="data row6 col2" >1</td>
      <td id="T_54907_row6_col3" class="data row6 col3" >1</td>
      <td id="T_54907_row6_col4" class="data row6 col4" >1</td>
      <td id="T_54907_row6_col5" class="data row6 col5" >1</td>
      <td id="T_54907_row6_col6" class="data row6 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row7" class="row_heading level0 row7" >7</th>
      <td id="T_54907_row7_col0" class="data row7 col0" >LCTSC-Train-S1-001</td>
      <td id="T_54907_row7_col1" class="data row7 col1" >b5bddb</td>
      <td id="T_54907_row7_col2" class="data row7 col2" >1</td>
      <td id="T_54907_row7_col3" class="data row7 col3" >1</td>
      <td id="T_54907_row7_col4" class="data row7 col4" >1</td>
      <td id="T_54907_row7_col5" class="data row7 col5" >1</td>
      <td id="T_54907_row7_col6" class="data row7 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row8" class="row_heading level0 row8" >8</th>
      <td id="T_54907_row8_col0" class="data row8 col0" >LCTSC-Test-S1-101</td>
      <td id="T_54907_row8_col1" class="data row8 col1" >cc682f</td>
      <td id="T_54907_row8_col2" class="data row8 col2" >1</td>
      <td id="T_54907_row8_col3" class="data row8 col3" >1</td>
      <td id="T_54907_row8_col4" class="data row8 col4" >1</td>
      <td id="T_54907_row8_col5" class="data row8 col5" >1</td>
      <td id="T_54907_row8_col6" class="data row8 col6" >1</td>
    </tr>
    <tr>
      <th id="T_54907_level0_row9" class="row_heading level0 row9" >9</th>
      <td id="T_54907_row9_col0" class="data row9 col0" >LCTSC-Train-S1-003</td>
      <td id="T_54907_row9_col1" class="data row9 col1" >8e34f9</td>
      <td id="T_54907_row9_col2" class="data row9 col2" >1</td>
      <td id="T_54907_row9_col3" class="data row9 col3" >1</td>
      <td id="T_54907_row9_col4" class="data row9 col4" >1</td>
      <td id="T_54907_row9_col5" class="data row9 col5" >1</td>
      <td id="T_54907_row9_col6" class="data row9 col6" >1</td>
    </tr>
  </tbody>
</table></div>
</div>
</section>
<section id="Check-for-Overlapping-Structures">
<h2>Check for Overlapping Structures<a class="headerlink" href="#Check-for-Overlapping-Structures" title="Permalink to this heading">#</a></h2>
<p>nnUNet (v1) is unable to handle structures which are overlapping. If there are structures which are overlapping, the PyDicer tool will assign the overlapping voxels to the smaller structure (to assign to the larger structure, set <code class="docutils literal notranslate"><span class="pre">nnunet.assign_overlap_to_largest=False</span></code>).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">check_overlapping_structures</span></code> function will log any structures which are overlapping and will be affected by this rule.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nnunet</span><span class="o">.</span><span class="n">check_overlapping_structures</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Esophagus overlaps with Heart for patient LCTSC-Train-S1-007 structure set ed6686
Esophagus overlaps with Lung_L for patient LCTSC-Train-S1-007 structure set ed6686
Esophagus overlaps with Lung_R for patient LCTSC-Train-S1-007 structure set ed6686
Heart overlaps with Lung_L for patient LCTSC-Train-S1-007 structure set ed6686
Heart overlaps with Lung_R for patient LCTSC-Train-S1-007 structure set ed6686
Esophagus overlaps with Heart for patient LCTSC-Train-S1-006 structure set ceb111
Esophagus overlaps with Lung_R for patient LCTSC-Train-S1-006 structure set ceb111
Heart overlaps with Lung_L for patient LCTSC-Train-S1-006 structure set ceb111
Heart overlaps with Lung_R for patient LCTSC-Train-S1-006 structure set ceb111
Lung_L overlaps with Lung_R for patient LCTSC-Train-S1-006 structure set ceb111
Esophagus overlaps with Heart for patient LCTSC-Test-S1-102 structure set 6c6ea4
Esophagus overlaps with Lung_L for patient LCTSC-Test-S1-102 structure set 6c6ea4
Esophagus overlaps with Lung_R for patient LCTSC-Test-S1-102 structure set 6c6ea4
Heart overlaps with Lung_L for patient LCTSC-Test-S1-102 structure set 6c6ea4
Heart overlaps with Lung_R for patient LCTSC-Test-S1-102 structure set 6c6ea4
Esophagus overlaps with Lung_R for patient LCTSC-Train-S1-002 structure set f036b8
Heart overlaps with Lung_L for patient LCTSC-Train-S1-002 structure set f036b8
Heart overlaps with Lung_R for patient LCTSC-Train-S1-002 structure set f036b8
Lung_L overlaps with Lung_R for patient LCTSC-Train-S1-002 structure set f036b8
Esophagus overlaps with Heart for patient LCTSC-Train-S1-008 structure set 48a970
Heart overlaps with Lung_L for patient LCTSC-Train-S1-008 structure set 48a970
Heart overlaps with Lung_R for patient LCTSC-Train-S1-008 structure set 48a970
Esophagus overlaps with Heart for patient LCTSC-Train-S1-004 structure set 61758b
Esophagus overlaps with Lung_L for patient LCTSC-Train-S1-004 structure set 61758b
Esophagus overlaps with Lung_R for patient LCTSC-Train-S1-004 structure set 61758b
Heart overlaps with Lung_L for patient LCTSC-Train-S1-004 structure set 61758b
Heart overlaps with Lung_R for patient LCTSC-Train-S1-004 structure set 61758b
Lung_L overlaps with Lung_R for patient LCTSC-Train-S1-004 structure set 61758b
Heart overlaps with Lung_L for patient LCTSC-Train-S1-005 structure set 68d663
Heart overlaps with Lung_R for patient LCTSC-Train-S1-005 structure set 68d663
Lung_L overlaps with Lung_R for patient LCTSC-Train-S1-005 structure set 68d663
Esophagus overlaps with Heart for patient LCTSC-Train-S1-001 structure set b5bddb
Esophagus overlaps with Lung_R for patient LCTSC-Train-S1-001 structure set b5bddb
Heart overlaps with Lung_L for patient LCTSC-Train-S1-001 structure set b5bddb
Heart overlaps with Lung_R for patient LCTSC-Train-S1-001 structure set b5bddb
Esophagus overlaps with Heart for patient LCTSC-Test-S1-101 structure set cc682f
Heart overlaps with Lung_L for patient LCTSC-Test-S1-101 structure set cc682f
Heart overlaps with Lung_R for patient LCTSC-Test-S1-101 structure set cc682f
Esophagus overlaps with Heart for patient LCTSC-Train-S1-003 structure set 8e34f9
Esophagus overlaps with Lung_L for patient LCTSC-Train-S1-003 structure set 8e34f9
Esophagus overlaps with Lung_R for patient LCTSC-Train-S1-003 structure set 8e34f9
Heart overlaps with Lung_L for patient LCTSC-Train-S1-003 structure set 8e34f9
Heart overlaps with Lung_R for patient LCTSC-Train-S1-003 structure set 8e34f9
Lung_L overlaps with Lung_R for patient LCTSC-Train-S1-003 structure set 8e34f9
pydicer.dataset.nnunet - WARNING - Overlapping structures were detected
</pre></div></div>
</div>
</section>
<section id="Prepare-nnUNet-Dataset">
<h2>Prepare nnUNet Dataset<a class="headerlink" href="#Prepare-nnUNet-Dataset" title="Permalink to this heading">#</a></h2>
<p>Now that all checks are complete, we can proceed with preparing the nnUNet dataset. Take a look in the dataset directory after the cell finishes running to confirm that everything worked as expected.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nnunet_dataset_path</span> <span class="o">=</span> <span class="n">nnunet</span><span class="o">.</span><span class="n">prepare_dataset</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dataset prepared in: </span><span class="si">{</span><span class="n">nnunet_dataset_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Dataset prepared in: nnScratch/nnUNet_raw_data/Task123_LCTSC_Test
</pre></div></div>
</div>
</section>
<section id="Prepare-nnUNet-Training-Scripts">
<h2>Prepare nnUNet Training Scripts<a class="headerlink" href="#Prepare-nnUNet-Training-Scripts" title="Permalink to this heading">#</a></h2>
<p>Consult the <a class="reference external" href="https://github.com/MIC-DKFZ/nnUNet/tree/master/documentation">nnUNet documentation</a> for information on model training. The <code class="docutils literal notranslate"><span class="pre">generate_training_scripts</span></code> may help prepare a script useful for training the nnUNet models for the dataset which was prepared.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add some additional commands at the top of the script (useful for activating a virtual</span>
<span class="c1"># environemnt)</span>
<span class="n">script_header</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;# source /path/to/venv/bin/activate&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">script_path</span> <span class="o">=</span> <span class="n">nnunet</span><span class="o">.</span><span class="n">generate_training_scripts</span><span class="p">(</span><span class="n">script_header</span><span class="o">=</span><span class="n">script_header</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training script ready in: </span><span class="si">{</span><span class="n">script_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Set the logging verbosity back to NOTSET</span>
<span class="n">pydicer</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">NOTSET</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Training script ready in: train_123_LCTSC_Test.sh
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="WorkingWithData.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Working with Data</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="AutoSegmentation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Auto-segmentation Inference &amp; Analysis</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Ingham Medical Physics
            </div>
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">nnUNet Data Preparation</a><ul>
<li><a class="reference internal" href="#Setup-nnUNet">Setup nnUNet</a></li>
<li><a class="reference internal" href="#Setup-PyDicer">Setup PyDicer</a></li>
<li><a class="reference internal" href="#Define-Structures">Define Structures</a></li>
<li><a class="reference internal" href="#Initialise-NNUNetDataset-object">Initialise <code class="docutils literal notranslate"><span class="pre">NNUNetDataset</span></code> object</a></li>
<li><a class="reference internal" href="#Inspect-Dataset">Inspect Dataset</a></li>
<li><a class="reference internal" href="#Check-Dataset">Check Dataset</a></li>
<li><a class="reference internal" href="#Split-Dataset">Split Dataset</a></li>
<li><a class="reference internal" href="#Check-for-Duplicate-Data">Check for Duplicate Data</a></li>
<li><a class="reference internal" href="#Check-Structure-Names">Check Structure Names</a></li>
<li><a class="reference internal" href="#Check-for-Overlapping-Structures">Check for Overlapping Structures</a></li>
<li><a class="reference internal" href="#Prepare-nnUNet-Dataset">Prepare nnUNet Dataset</a></li>
<li><a class="reference internal" href="#Prepare-nnUNet-Training-Scripts">Prepare nnUNet Training Scripts</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>